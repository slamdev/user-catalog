task remoteDeploy << {
    remotes {
        config {
            host = deployHost()
            user = deployUser
            identity = file(deployKey)
            knownHosts = allowAnyHosts
        }
    }
    ssh.run {
        session(remotes.config) {
            logger.quiet('Stopping previous application')
            execute 'if pgrep java &> /dev/null ; then killall -9 java ; fi'
            logger.quiet('Uploading new application')
            put from: file("${jar.archivePath}"), into: '/tmp'
            logger.quiet('Starting new application')
            execute "java -jar /tmp/${jar.archiveName} > /dev/null 2>&1 &"
        }
    }
}

remoteDeploy.dependsOn assemble
